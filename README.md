### GGRN: benchmarking across a Grammar of Gene Regulatory Network inference methods 

This repo contains tools for benchmarking various strategies for predicting in detail the outcome of perturbation experiments. For more context, see the [project summary](https://docs.google.com/document/d/1vvZi5c0nU3VTvKiWpEka8AtDORxJ3Ymv0ZzoFQwoDoI/edit).

### Experiments

The benchmarks in this project are composed of small, structured folders called Experiments. Code and metadata supporting each Experiment resides in a folder in `experiments`, and an individual Experiment can be run via `run_experiments.sh` or `do_one_experiment.py`. The most important parts of each Experiment are:

- `outputs`: these results are auto-generated by our software based on user input and our data collections.
- `metadata.json`: A complete specification of the Experiment, provided by the user. We do not have explicit docs for the metadata yet, but if you want to write your own, validation and default-setting are done using a function from this repo's [companion package](https://github.com/ekernf01/perturbation_benchmarking_package). The most important information in the metadata is:
    - An explanatory "README" field describing the purpose of the experiment
    - The question it addresses (from `guiding_questions.txt`)
    - ONE associated perturbation dataset (from the perturbation dataset repo)

### Keeping track of our experiments

It can be hard to understand how all these experiments relate to one another, software-wise or science-wise. Run `gather_experiment_metadata.py` to produce a quick summary table describing all experiments, or read `all_experiments.tsv` for the most recent such summary. 

### Installation

The project is written in Python. We use Conda + Mamba to manage most dependencies. We offer either a flexible install or an exact install of our environment. Each option has a CPU version and a GPU version, though the GPU version is not well-tested.

#### Flexible install

Some flexibility in exact requirements is useful in case of different operating systems.
To install roughly the same versions we use, we start with the dependencies given in `environment/conda_inputs.yaml`. We also use a few packages only available via pip. Here is the code.

```bash
mamba env create --name ggrn --file environment/conda_inputs.yaml
conda activate ggrn
pip install cell-gears==0.0.4  --no-deps
pip install celloracle==0.12.0 --no-deps
pip install prescient==0.1.0   --no-deps 
pip install geomloss==0.2.3    --no-deps 
pip install vl-convert-python
for p in load_networks load_perturbations ggrn_backend2 ggrn_backend3 ggrn perturbation_benchmarking_package do
    pip install -e ../$p
done
git clone https://huggingface.co/ctheodoris/Geneformer
cd Geneformer
pip install .
```

#### Exact reproduction

Exactly reproducing our experiments requires a large computer running Ubuntu 20.04. We recommend using Amazon Web Services. When selecting an instance, we expect 500GB of disk space and 64GB of RAM is enough. The environment can be reproduced via `environment/set_up_environment.sh`. 